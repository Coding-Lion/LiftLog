
<TextField
    data-cy="exercise-name"
    TextFieldType="TextFieldType.Outline"
    class="w-full mb-2 text-xl"
    Label="Exercise"
    Value="@Exercise.Name"
    required
    OnChange="@(val => SetExerciseName(val!))">
</TextField>
<div class="flex flex-wrap justify-around w-full gap-4">
    <div class="flex flex-col items-center gap-2">
        <FixedIncrementer
            data-cy="exercise-sets"
            Value="Exercise.Sets"
            Increment="() => IncrementExerciseSets()"
            Decrement="() => DecrementExerciseSets()"
            Label="Sets"/>
        <FixedIncrementer
            data-cy="exercise-reps"
            Value="Exercise.RepsPerSet"
            Increment="() => IncrementExerciseRepsPerSet()"
            Decrement="() => DecrementExerciseRepsPerSet()"
            Label="Reps"/>
    </div>
    <EditableIncrementer
        Increment="0.1m"
        Label="Progressive Overload Amount"
        data-cy="exercise-auto-increase"
        Suffix=@WeightSuffix
        Value="Exercise.WeightIncreaseOnSuccess"
        OnChange="e => SetExerciseSuccessWeight(e)"/>

    <Switch Label="Superset With Next Exercise" data-cy="exercise-superset" Value="Exercise.SupersetWithNext" OnSwitched="supersets => SetExerciseSupersetsNext(supersets)"/>

    <RestEditorGroup Rest="Exercise.RestBetweenSets" OnRestUpdated="rest => OnRestUpdated(rest)"/>
</div>

@code
{
    [Parameter] [EditorRequired] public Action<ExerciseBlueprint> UpdateExercise { get; set; } = null!;

    [Parameter] [EditorRequired] public ExerciseBlueprint Exercise { get; set; } = null!;

    [CascadingParameter(Name = "UseImperial")]
    public bool UseImperialUnits { get; set; }

    private string WeightSuffix => UseImperialUnits ? "lbs" : "kg";

    void DecrementExerciseSets() => UpdateExercise(Exercise with { Sets = Math.Max(Exercise.Sets - 1, 1) });

    void IncrementExerciseSets() => UpdateExercise(Exercise with { Sets = Exercise.Sets + 1 });

    void DecrementExerciseRepsPerSet() => UpdateExercise(Exercise with { RepsPerSet = Math.Max(Exercise.RepsPerSet - 1, 1) });

    void IncrementExerciseRepsPerSet() => UpdateExercise(Exercise with { RepsPerSet = Exercise.RepsPerSet + 1 });

    void SetExerciseName(string name) => UpdateExercise(Exercise with { Name = name });

    void SetExerciseSupersetsNext(bool supersets)
        => UpdateExercise(Exercise with { SupersetWithNext = supersets });

    void SetExerciseSuccessWeight(decimal weight)
        => UpdateExercise(Exercise with { WeightIncreaseOnSuccess = weight });

    void OnRestUpdated(Rest rest) => UpdateExercise(Exercise with { RestBetweenSets = rest });

}
